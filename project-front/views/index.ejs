<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uploader de fichiers</title>
    <link href="/css/style.css" rel="stylesheet" type="text/css">
</head>
<body>

    <div id="upload-form">
        <input type="file" id="file-input" multiple>
        <button onclick="uploadFiles()">Uploader</button>
    </div>

    <div id="file-container">
        <div id="no-files-message">Aucun fichier disponible.</div>
    </div>

    <div class="progress-bar">
        <div class="progress" id="progress"></div>
        <div class="progress-info">
            <span id="percentage">0%</span>
            <span id="time-remaining">Temps restant : Calcul en cours...</span>
        </div>
    </div>

    <script>
        function uploadFiles() {
            var input = document.getElementById('file-input');
            var fileContainer = document.getElementById('file-container');
            var progressBar = document.getElementById('progress');
            var percentageText = document.getElementById('percentage');
            var timeRemainingText = document.getElementById('time-remaining');
            var noFilesMessage = document.getElementById('no-files-message');

            fileContainer.innerHTML = ''; // Réinitialise le contenu du conteneur

            if (input.files.length === 0) {
                noFilesMessage.style.display = 'block';
                fileContainer.style.display = 'none';
                return;
            }

            noFilesMessage.style.display = 'none';
            fileContainer.style.display = 'block';

            for (var i = 0; i < input.files.length; i++) {
                var fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span>${input.files[i].name}</span>
                    <div class="file-actions">
                        <button class="action-button" onclick="downloadFile('${input.files[i].name}')">&#x21E9;</button>
                        <button class="action-button" onclick="editFileName('${input.files[i].name}')">&#x270E;</button>
                        <button class="action-button" onclick="deleteFile('${input.files[i].name}')">&#x1F5D1;</button>
                    </div>
                `;
                fileContainer.appendChild(fileItem);

                var xhr = new XMLHttpRequest();
                var formData = new FormData();
                formData.append('file', input.files[i]);

                xhr.upload.onprogress = function(event) {
                    if (event.lengthComputable) {
                        var progress = (event.loaded / event.total) * 100;
                        progressBar.style.width = progress + '%';
                        percentageText.textContent = Math.round(progress) + '%';

                        var timeRemaining = calculateTimeRemaining(event);
                        timeRemainingText.textContent = 'Temps restant : ' + formatTime(timeRemaining);
                    }
                };

                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        console.log('Upload terminé :', input.files[i].name);
                    }
                };

                xhr.open('POST', 'votre-endpoint-d-upload', true);
                xhr.send(formData);
            }
        }

        function calculateTimeRemaining(event) {
            var bytesUploaded = event.loaded;
            var totalBytes = event.total;
            var bytesPerSecond = bytesUploaded / (event.timeStamp / 1000);
            var remainingBytes = totalBytes - bytesUploaded;
            var timeRemaining = remainingBytes / bytesPerSecond;
            return timeRemaining;
        }

        function formatTime(seconds) {
            var minutes = Math.floor(seconds / 60);
            seconds = Math.floor(seconds % 60);
            return minutes + ' min ' + seconds + ' sec';
        }

        function downloadFile(fileName) {
            console.log('Télécharger :', fileName);
        }

        function editFileName(fileName) {
            var newName = prompt('Entrez le nouveau nom de fichier :');
            if (newName) {
                console.log('Modifier le nom de', fileName, 'à', newName);
            }
        }

        function deleteFile(fileName) {
            if (confirm('Voulez-vous vraiment supprimer le fichier ' + fileName + '?')) {
                console.log('Supprimer :', fileName);
            }
        }
    </script>

</body>
</html>
